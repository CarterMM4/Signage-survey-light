<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Southwood Signage Survey</title>

  <!-- Look & feel -->
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1530;
      --panel-2:#111a38;
      --soft:#0d142c;
      --text:#eef2ff;
      --muted:#a6b1d8;
      --accent:#22c55e;           /* Southwood green */
      --accent-2:#16a34a;
      --accent-3:#065f46;
      --line:#263057;
      --chip:#122045;
      --warn:#f59e0b;
      --err:#ef4444;
      --ok:#22c55e;
      --blue:#3b82f6;
      --red:#ef4444;
      --yellow:#f59e0b;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: radial-gradient(1200px 800px at 20% -10%, #0f1a33 0%, #0b1020 55%, #090e1c 100%); color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }

    .app { display: grid; grid-template-rows: auto 1fr; height: 100%; }

    .topbar {
      display: flex; align-items: center; gap: .75rem;
      padding: .7rem .9rem;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, #0f1936, #0b1330);
      position: sticky; top: 0; z-index: 10;
    }
    .brand { display:flex; align-items:center; gap:.6rem; font-weight:700; letter-spacing:.2px; }
    .brand .dot { width:10px; height:10px; border-radius:999px; background: var(--accent); box-shadow:0 0 0 3px rgba(34,197,94,.18); }
    .topbar .spacer { flex: 1; }
    .btn { background: #18224a; border:1px solid #2a3664; color: var(--text); padding:.5rem .7rem; border-radius:10px; cursor:pointer; font-weight:600; }
    .btn:hover { background:#1f2b5c; }
    .btn.primary { background: linear-gradient(180deg, var(--accent), var(--accent-2)); border-color: #1d8f49; color:#07120b; }
    .btn.ghost { background: transparent; border-color: transparent; color: var(--muted); }
    input, select { background:#0e1633; border:1px solid #2a3664; color:var(--text); padding:.5rem .6rem; border-radius:10px; }
    .pill { background:#0f1738; border:1px solid #263463; border-radius:999px; padding:.25rem .5rem; display:inline-flex; align-items:center; gap:.4rem; color:#dbe3ff; font-size:.9rem; }
    .muted { color: var(--muted); }

    /* VIEWS */
    .view { display:none; height: 100%; }
    .view.active { display:block; }

    /* HOME VIEW */
    .home { padding: 1rem; display:grid; grid-template-rows: auto 1fr; gap: 1rem; }
    .home-actions { display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
    .grid-cards { display:grid; grid-template-columns: repeat(auto-fill, minmax(260px,1fr)); gap:.9rem; height:100%; overflow:auto; padding-bottom:1rem; }
    .card {
      background: linear-gradient(180deg, #0f1733, #0b132a);
      border:1px solid #24305b; border-radius:16px; padding:.9rem; display:flex; flex-direction:column; gap:.6rem;
    }
    .card h4 { margin:.1rem 0; }
    .card small { color:var(--muted); }
    .card .row { display:flex; align-items:center; justify-content:space-between; gap:.5rem; }

    /* PROJECT VIEW (pages + actions) */
    .project { display:grid; grid-template-rows:auto 1fr; gap:.7rem; padding: .9rem; }
    .project .actions { display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
    .page-grid { height:100%; overflow:auto; display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:.75rem; padding-bottom: 1rem; }
    .page {
      background:#0f1735; border:1px solid #22305c; border-radius:14px; padding:.6rem; display:flex; flex-direction:column; gap:.5rem;
    }
    .page img { width:100%; height:140px; object-fit:cover; border-radius:10px; background:#071022; border:1px solid #1f2b56; }
    .page input { width:100%; }

    /* EDITOR VIEW (current page + pins) */
    .editor { padding:.8rem; height:100%; display:grid; grid-template-columns: 240px 1fr 340px; gap:.8rem; }
    .panel {
      background:#0f1735; border:1px solid #22305c; border-radius:14px; overflow:hidden; display:flex; flex-direction:column; min-height:0;
    }
    .panel > header { padding:.6rem .75rem; border-bottom:1px solid #22305c; display:flex; align-items:center; justify-content:space-between; }
    .panel > header h3 { margin:0; font-size: .95rem; color:#cfe3ff; }
    .panel .body { padding:.6rem .75rem; overflow:auto; display:flex; flex-direction:column; gap:.6rem; }

    .thumbs { display:grid; gap:.5rem; }
    .thumb { background:#0c1430; border:1px solid #22305c; border-radius:10px; padding:.35rem; cursor:pointer; }
    .thumb.active { outline:2px solid var(--accent); }
    .thumb img { width:100%; height:102px; object-fit:cover; border-radius:8px; background:#071022; }
    .thumb input { width:100%; margin-top:.35rem; }

    .stage { position:relative; background:#09132a; border:1px dashed #2b3763; border-radius:14px; height:100%; display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .stage-inner{ position:relative; width:100%; height:100%; display:flex; align-items:center; justify-content:center }
    #stageImage{ max-width:100%; max-height:100%; display:block; }
    #pinLayer{ position:absolute; inset:0; pointer-events:none; }
    .pin{
      position:absolute; transform:translate(-50%, -100%); padding:.22rem .46rem;
      border-radius:999px; font-weight:700; border:1px solid rgba(0,0,0,.35);
      color:#03120a; background: var(--accent); pointer-events:auto; font-size:.82rem;
      box-shadow: 0 4px 12px rgba(0,0,0,.35);
      user-select:none;
    }
    .pin:hover { filter: brightness(0.95); }
    .pin.selected { outline:2px solid #fff; }
    .measure-svg { position:absolute; inset:0; pointer-events:none; }

    .controls { display:flex; flex-wrap:wrap; gap:.45rem; align-items:center; }
    .chips { display:flex; flex-wrap:wrap; gap:.35rem; }
    .tag { font-size:.78rem; padding:.15rem .45rem; border-radius:999px; background:#15214a; border:1px solid #2a3766; color:#dbe4ff; }

    .list { display:grid; gap:.4rem; }
    .rowx { display:grid; grid-template-columns: 20px 1fr auto; align-items:center; gap:.5rem; padding:.4rem .5rem; border:1px solid #273462; background:#0f1838; border-radius:10px; }
    .row { display:grid; grid-template-columns: 110px 1fr; gap:.6rem; align-items:center; }

    /* Photo modal */
    .modal { position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:100; }
    .modal .box { background:#0e1533; border:1px solid #2a386b; border-radius:16px; width:min(1000px, 95vw); height:min(88vh, 95vh); display:flex; flex-direction:column; }
    .modal header { display:flex; align-items:center; justify-content:space-between; padding:.65rem .85rem; border-bottom:1px solid #2a386b; }
    .modal main { flex:1; display:grid; grid-template-columns: 1fr 300px; min-height:0; }
    .modal .viewer { position:relative; background:#050b1c; overflow:auto; }
    .modal .viewer img { display:block; max-width: none; } /* allow zoomed scrolling */
    .modal .side { border-left:1px solid #2a386b; padding:.65rem; overflow:auto; }
    .modal .side .grid { display:grid; grid-template-columns: 1fr 1fr; gap:.5rem; }

    /* Floating help on stage */
    .toast {
      position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
      background:#0f1836; border:1px solid #263565; color:#d9e3ff; padding:.35rem .6rem; border-radius:999px;
      font-size:.85rem; pointer-events:none; opacity:.9;
    }

    /* Scrollbars (subtle) */
    ::-webkit-scrollbar { height: 12px; width: 12px; }
    ::-webkit-scrollbar-track { background: #0b132b; }
    ::-webkit-scrollbar-thumb { background: #1c2a57; border-radius: 10px; border:2px solid #0b132b; }
    ::-webkit-scrollbar-thumb:hover { background:#243468; }
  </style>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>
  <script>
    if (window['pdfjsLib']) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
    }
  </script>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="brand"><span class="dot"></span> Southwood Signage Survey</div>
      <div class="spacer"></div>
      <button class="btn ghost" id="navHome">Home</button>
      <button class="btn" id="navProjects">Projects</button>
      <button class="btn primary" id="navEditor">Editor</button>
    </div>

    <!-- VIEWS -->
    <!-- Home -->
    <div id="viewHome" class="view home active">
      <div class="home-actions">
        <button class="btn primary" id="btnCreateProject">New Project</button>
        <input id="inputNewName" placeholder="Project name…" style="min-width:220px">
        <span class="pill">Quick tip: double-click a project card to open.</span>
      </div>
      <div class="grid-cards" id="homeCards"></div>
    </div>

    <!-- Project (pages & upload) -->
    <div id="viewProject" class="view project">
      <div class="actions">
        <button class="btn" id="btnProjectBack">← Back</button>
        <button class="btn primary" id="btnUpload">Upload Map / Plan</button>
        <input type="file" id="inputUpload" accept="image/*,application/pdf" multiple style="display:none">
        <span class="pill">Project: <strong id="lblProjName">—</strong></span>
      </div>
      <div class="page-grid" id="pageGrid"></div>
    </div>

    <!-- Editor -->
    <div id="viewEditor" class="view editor">
      <!-- Left: pages -->
      <div class="panel">
        <header><h3>Pages</h3></header>
        <div class="body">
          <div class="thumbs" id="thumbs"></div>
          <div class="muted">Click a page to switch. Rename under each thumbnail.</div>
        </div>
      </div>

      <!-- Middle: canvas -->
      <div class="panel" style="display:grid; grid-template-rows:auto auto 1fr;">
        <header>
          <h3>Stage</h3>
          <div class="controls">
            <button class="btn" id="btnAddPin">Add Pin</button>
            <button class="btn" id="btnMeasureToggle">Measure: OFF</button>
            <button class="btn" id="btnCalibrate">Calibrate</button>
            <button class="btn" id="btnMeasureReset">Reset</button>
            <span class="pill">Building <input id="inputBuilding" placeholder="A" style="width:90px"></span>
            <span class="pill">Level <input id="inputLevel" placeholder="1" style="width:70px"></span>
          </div>
        </header>

        <div class="controls" style="padding:.5rem .75rem; gap:.5rem; border-bottom:1px solid #22305c;">
          <input id="inputSearch" placeholder="Search…" style="min-width:200px;">
          <select id="filterType"><option value="">All Types</option></select>
          <label class="pill"><input type="checkbox" id="toggleField"> Field Mode</label>
        </div>

        <div class="stage" id="stage">
          <div class="stage-inner">
            <img id="stageImage" alt="No page yet" />
            <svg id="measureSvg" class="measure-svg" width="100%" height="100%"></svg>
            <div id="pinLayer"></div>
            <div class="toast" id="toast" style="display:none;">Drag pins, double-click to open photos. When measuring: click two points.</div>
          </div>
        </div>
      </div>

      <!-- Right: details & list -->
      <div class="panel">
        <header><h3>Pin Details</h3></header>
        <div class="body" style="gap:.7rem;">
          <div class="row"><div>Selected</div><div id="selId" class="muted">None</div></div>
          <div class="row"><div>Type</div>
            <select id="fieldType"></select></div>
          <div class="row"><div>Custom Label</div><input id="fieldCustom"/></div>
          <div class="row"><div>Room #</div><input id="fieldRoomNum"/></div>
          <div class="row"><div>Room Name</div><input id="fieldRoomName"/></div>
          <div class="row"><div>Building</div><input id="fieldBuilding"/></div>
          <div class="row"><div>Level</div><input id="fieldLevel"/></div>
          <div class="row"><div>Notes</div><input id="fieldNotes"/></div>
          <div class="row"><div>Position</div><div id="posLabel" class="muted">—</div></div>
          <div class="chips" id="warns"></div>

          <div class="controls" style="margin-top:.3rem;">
            <button class="btn" id="btnAddPhoto">Add Photo</button>
            <button class="btn" id="btnOpenPhoto">Open Photo</button>
            <button class="btn" id="btnDuplicate">Duplicate</button>
            <button class="btn" id="btnDelete">Delete</button>
            <input type="file" id="inputPhoto" accept="image/*" multiple style="display:none">
          </div>

          <header style="margin-top:.8rem; border-top:1px solid #22305c; padding-top:.6rem;">
            <h3 style="margin:0;">Pins</h3>
          </header>
          <div class="controls">
            <button class="btn" id="btnBulkType">Bulk: Set Type</button>
            <button class="btn" id="btnBulkBL">Bulk: Set Bldg/Level</button>
          </div>
          <div id="pinList" class="list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Photo Modal -->
  <div class="modal" id="photoModal">
    <div class="box">
      <header>
        <strong>Photo Viewer & Measure</strong>
        <div style="display:flex; gap:.5rem; align-items:center;">
          <button class="btn" id="btnPhotoMeasure">Measure: OFF</button>
          <button class="btn" id="btnPhotoCalib">Set Scale</button>
          <button class="btn" id="btnPhotoPrev">Prev</button>
          <button class="btn" id="btnPhotoNext">Next</button>
          <button class="btn" id="btnPhotoDownload">Download</button>
          <button class="btn" id="btnPhotoDelete">Delete</button>
          <button class="btn primary" id="btnPhotoClose">Close</button>
        </div>
      </header>
      <main>
        <div class="viewer" id="photoViewer">
          <img id="photoImg" alt="">
          <svg id="photoMeasureSvg" class="measure-svg" style="position:absolute; inset:0;"></svg>
        </div>
        <div class="side">
          <div class="row"><div>Pin</div><div id="photoPinId" class="muted">—</div></div>
          <div class="row"><div>Photo</div><div id="photoName" class="muted">—</div></div>
          <div class="row"><div>Measures</div><div id="photoMeaCount" class="muted">0</div></div>
          <div class="muted" style="margin-top:.4rem;">Tip: When measuring, click start point then move to see the live line; click end point to confirm and enter the real length.</div>
        </div>
      </main>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>

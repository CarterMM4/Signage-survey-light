<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Southwood Signage Survey</title>

  <!-- Favicon (inline) -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='10' ry='10' fill='%2310181b'/%3E%3Cpath d='M12 42 L28 22 L40 36 L52 24' stroke='%2322c55e' stroke-width='6' fill='none'/%3E%3Ccircle cx='28' cy='22' r='3' fill='%23a7f3d0'/%3E%3Ccircle cx='40' cy='36' r='3' fill='%23a7f3d0'/%3E%3Ccircle cx='52' cy='24' r='3' fill='%23a7f3d0'/%3E%3C/svg%3E" />

  <!-- Core styles -->
  <style>
    :root{
      --bg:#0a1214;
      --panel:#0f1719;
      --soft:#121e21;
      --text:#ecf4f6;
      --muted:#a9c0c6;
      --accent:#22c55e; /* Southwood green */
      --accent-2:#16a34a;
      --blue:#3b82f6;
      --red:#ef4444;
      --amber:#f59e0b;
      --border:#1e2a2d;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none}
    button{cursor:pointer}
    .app{min-height:100%; display:grid; grid-template-rows:auto 1fr}

    /* Top brand bar */
    .brandbar{
      display:flex; align-items:center; gap:.75rem;
      padding:.75rem 1rem; border-bottom:1px solid var(--border);
      background:linear-gradient(180deg, #0e1618, #0b1214);
      position:sticky; top:0; z-index:20;
    }
    .brandlogo{width:28px; height:28px; background:var(--accent); border-radius:6px; display:grid; place-items:center; color:#07250f; font-weight:800}
    .brandtitle{font-weight:700; letter-spacing:.2px}
    .brandspacer{flex:1}
    .pill{display:inline-flex; align-items:center; gap:.5rem; padding:.4rem .6rem; background:#0f1b1e; border:1px solid var(--border); border-radius:999px; color:#bfe9c9; font-size:.85rem}

    /* Views */
    .view{display:none; padding:1rem}
    .view.active{display:block}

    /* Home (projects) */
    .home-head{display:flex; align-items:center; gap:.75rem; margin-bottom:1rem}
    .home-grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:12px}
    .card{
      background:var(--panel); border:1px solid var(--border); border-radius:14px; overflow:hidden;
      display:flex; flex-direction:column; min-height:140px;
    }
    .card header{padding:.75rem .9rem; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between}
    .card main{padding:.75rem .9rem; color:var(--muted); font-size:.9rem}
    .card footer{padding:.6rem .9rem; border-top:1px solid var(--border); display:flex; gap:.5rem; flex-wrap:wrap}
    .btn{background:#112023; border:1px solid var(--border); color:var(--text); padding:.45rem .65rem; border-radius:10px; font-size:.9rem}
    .btn:hover{background:#142629}
    .btn.acc{background:var(--accent); border-color:#195f32; color:#06230e; font-weight:700}
    .btn.acc:hover{background:var(--accent-2)}
    .btn.ghost{background:transparent}
    input[type="text"], input[type="number"], select{
      background:#0f1b1e; border:1px solid var(--border); color:var(--text); padding:.45rem .6rem; border-radius:10px; width:100%;
    }

    /* Editor layout */
    .layout{display:grid; grid-template-columns:250px 1fr 340px; gap:10px; height:calc(100vh - 68px); padding:10px}
    .panel{
      background:var(--panel); border:1px solid var(--border); border-radius:14px; overflow:hidden; min-height:0; display:flex; flex-direction:column;
    }
    .ph{margin:0; padding:.65rem .85rem; border-bottom:1px solid var(--border); background:#0e1719; color:#dff8e6; font-size:.95rem; display:flex; align-items:center; justify-content:space-between}
    .section{padding:.7rem .85rem; border-bottom:1px solid var(--border)}
    .thumbs{padding:.6rem; overflow:auto; display:grid; gap:.55rem}
    .thumb{background:#0f1b1e; border:1px solid var(--border); border-radius:10px; padding:.4rem; cursor:pointer}
    .thumb.active{outline:2px solid var(--accent)}
    .thumb img{width:100%; height:110px; object-fit:cover; border-radius:6px; background:#071012}
    .thumb input{width:100%; margin-top:.35rem; font-size:.85rem}

    .toolbar{display:flex; flex-wrap:wrap; gap:.5rem; align-items:center; padding:.6rem .8rem; border-bottom:1px solid var(--border); background:#0f1719}
    .toolbar .group{display:flex; gap:.45rem; align-items:center; background:#0d181a; border:1px solid var(--border); border-radius:12px; padding:.35rem .45rem}

    .stage{position:relative; background:#061013; border:1px dashed #203337; border-radius:14px; display:flex; align-items:center; justify-content:center; overflow:hidden}
    .stage-inner{position:relative; width:100%; height:100%; display:flex; align-items:center; justify-content:center}
    #stageImage{max-width:100%; max-height:100%; display:block; user-select:none}
    #pinLayer{position:absolute; inset:0; pointer-events:none}
    .pin{position:absolute; transform:translate(-50%,-100%); padding:.18rem .4rem; font-size:.78rem; border-radius:999px; border:1px solid rgba(0,0,0,.35); background:var(--accent); color:#052211; font-weight:800; box-shadow:0 3px 10px rgba(0,0,0,.35); pointer-events:auto}
    .pin.selected{outline:2px solid #fff}

    .measure{position:absolute; pointer-events:none}
    .measure text{fill:#fff; font-size:12px; paint-order:stroke; stroke:#000; stroke-width:3}
    .right{overflow:auto}

    /* Photo modal */
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:60; background:rgba(0,0,0,.6)}
    .modal .box{background:#0e1719; border:1px solid var(--border); border-radius:16px; width:min(1100px,95vw); height:min(85vh,95vh); display:flex; flex-direction:column}
    .modal header{display:flex; align-items:center; justify-content:space-between; padding:.7rem .9rem; border-bottom:1px solid var(--border)}
    .modal main{flex:1; display:grid; grid-template-columns:1fr 320px; min-height:0}
    .viewer{position:relative; background:#071012; overflow:auto}
    .viewer img{max-width:100%; height:auto; display:block; margin:auto}
    .side{border-left:1px solid var(--border); padding:.7rem .85rem; overflow:auto}
    .thumb-row{display:flex; flex-wrap:wrap; gap:.4rem; margin-top:.5rem}
    .phThumb{width:56px; height:56px; object-fit:cover; border-radius:8px; border:1px solid var(--border); cursor:pointer}
    .phThumb.active{outline:2px solid var(--accent)}
    .help{font-size:.85rem; color:var(--muted)}

    .muted{color:var(--muted)}
    .ok{color:var(--accent)}
  </style>

  <!-- CDNs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/5.1.0/tesseract.min.js"></script>
  <script>
    if (window['pdfjsLib']) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
    }
  </script>
</head>
<body>
  <div class="app">
    <!-- Brand bar -->
    <div class="brandbar">
      <div class="brandlogo">S</div>
      <div class="brandtitle">Southwood Signage Survey</div>
      <div class="brandspacer"></div>
      <span class="pill">Fast • Field-friendly • Reliable</span>
    </div>

    <!-- HOME VIEW (Projects Hub) -->
    <div id="viewHome" class="view active">
      <div class="home-head">
        <button class="btn acc" id="btnNewProject">New Project</button>
        <input id="homeSearch" type="text" placeholder="Search projects…" style="max-width:280px">
      </div>
      <div class="home-grid" id="homeGrid"></div>
    </div>

    <!-- EDITOR VIEW -->
    <div id="viewEditor" class="view">
      <!-- Editor toolbar -->
      <div class="toolbar">
        <div class="group">
          <button class="btn" id="btnBackHome">← Projects</button>
          <button class="btn" id="btnRename">Rename</button>
          <button class="btn" id="btnSaveAs">Duplicate</button>
        </div>

        <div class="group">
          <input type="file" id="inputUpload" accept="image/*,application/pdf" multiple style="display:none" />
          <button class="btn acc" id="btnUpload">Add Page (Image/PDF)</button>
          <label class="pill">Building <input id="inputBuilding" type="text" style="width:120px" placeholder="A"></label>
          <label class="pill">Level <input id="inputLevel" type="text" style="width:80px" placeholder="1"></label>
        </div>

        <div class="group">
          <button class="btn" id="btnExportCSV">CSV</button>
          <button class="btn" id="btnExportXLSX">Excel</button>
          <button class="btn" id="btnExportZIP">ZIP + photos</button>
          <input type="file" id="inputImportCSV" accept="text/csv" style="display:none" />
          <button class="btn" id="btnImportCSV">Import CSV</button>
        </div>

        <div class="group">
          <button class="btn" id="btnOCR">OCR this View</button>
          <button class="btn" id="btnCalibrate">Calibrate Stage</button>
          <button class="btn" id="btnMeasureToggle">Measuring: OFF</button>
          <button class="btn" id="btnMeasureReset">Reset Measure</button>
        </div>

        <div class="group">
          <button class="btn" id="btnUndo">Undo</button>
          <button class="btn" id="btnRedo">Redo</button>
        </div>

        <div class="group">
          <input id="inputSearch" type="text" placeholder="Search pins…" style="width:200px">
          <select id="filterType"><option value="">All Types</option></select>
          <label class="pill"><input type="checkbox" id="toggleField"> Field Mode</label>
        </div>

        <div class="group">
          <button class="btn" id="btnClearPins">Clear Pins (page)</button>
          <button class="btn acc" id="btnAddPin">Add Pin</button>
        </div>

        <div class="muted" id="projectLabel" style="margin-left:auto">—</div>
      </div>

      <!-- Editor layout -->
      <div class="layout">
        <!-- Pages -->
        <div class="panel">
          <h3 class="ph">Pages</h3>
          <div class="thumbs" id="thumbs"></div>
          <div class="section muted">Tip: Click a page to switch. Rename under each thumbnail.</div>
        </div>

        <!-- Stage -->
        <div class="panel stage" id="stage">
          <div class="stage-inner">
            <img id="stageImage" alt="No page yet" draggable="false"/>
            <svg id="measureSvg" class="measure" width="100%" height="100%"></svg>
            <div id="pinLayer"></div>
          </div>
        </div>

        <!-- Right panel -->
        <div class="panel right">
          <h3 class="ph">Pin Details</h3>
          <div class="section">
            <div class="section" style="display:grid; grid-template-columns:110px 1fr; gap:.5rem; align-items:center">
              <div>Selected</div><div id="selId" class="muted">None</div>
              <div>Type</div><div><select id="fieldType" style="width:100%"></select></div>
              <div>Custom Label</div><div><input id="fieldLabel" type="text" placeholder="Short label on map (e.g., EXIT)"></div>
              <div>Room #</div><div><input id="fieldRoomNum" type="text"></div>
              <div>Room Name</div><div><input id="fieldRoomName" type="text"></div>
              <div>Building</div><div><input id="fieldBuilding" type="text"></div>
              <div>Level</div><div><input id="fieldLevel" type="text"></div>
              <div>Notes</div><div><input id="fieldNotes" type="text"></div>
              <div>Position</div><div id="posLabel" class="muted">—</div>
            </div>

            <div class="section" style="display:grid; grid-template-columns:1fr 1fr; gap:.5rem">
              <button class="btn" id="btnAddPhoto">Add Photo(s)</button>
              <button class="btn" id="btnOpenPhoto">Open Photo Viewer</button>
              <button class="btn" id="btnDuplicate">Duplicate Pin</button>
              <button class="btn" id="btnDelete">Delete Pin</button>
              <input type="file" id="inputPhoto" accept="image/*" multiple style="display:none" />
            </div>

            <div class="section" id="warns"></div>
          </div>

          <h3 class="ph">Pins</h3>
          <div class="section">
            <div class="list" id="pinList" style="display:grid; gap:.4rem; max-height:280px; overflow:auto"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Photo Modal -->
  <div class="modal" id="photoModal">
    <div class="box">
      <header>
        <strong>Photo Viewer & Measure</strong>
        <div style="display:flex; gap:.5rem; align-items:center">
          <button class="btn" id="btnPhotoMeasure">Measure: OFF</button>
          <button class="btn" id="btnPhotoCalib">Re-Calibrate</button>
          <button class="btn" id="btnPhotoClose">Close</button>
        </div>
      </header>
      <main>
        <div class="viewer">
          <img id="photoImg" alt="">
          <svg id="photoMeasureSvg" class="measure" width="100%" height="100%" style="position:absolute; inset:0; pointer-events:none"></svg>
          <!-- live rubber-band overlay -->
          <svg id="photoOverlay" class="measure" width="100%" height="100%" style="position:absolute; inset:0; pointer-events:none"></svg>
        </div>
        <div class="side">
          <div class="muted" style="margin-bottom:.5rem">Pin <span id="photoPinId">—</span></div>
          <div class="muted" style="margin-bottom:.5rem">Photo <span id="photoName">—</span></div>
          <div class="muted" style="margin-bottom:.75rem">Measures: <span id="photoMeaCount">0</span></div>

          <div style="display:grid; grid-template-columns:1fr 1fr; gap:.5rem; margin:.5rem 0">
            <button class="btn" id="btnPhotoPrev">Prev</button>
            <button class="btn" id="btnPhotoNext">Next</button>
            <button class="btn" id="btnPhotoDelete">Delete Photo</button>
            <button class="btn" id="btnPhotoDownload">Download Photo</button>
          </div>

          <div class="section" style="border:none; padding:0">
            <strong>Photos</strong>
            <div class="thumb-row" id="photoThumbRow"></div>
          </div>

          <div class="help" style="margin-top:.8rem">
            Tip: Click once to start a measurement, move the mouse to see the line, click again to finish, then enter the measured feet from site. We’ll compute the photo’s px/ft from that so future lines show clean feet automatically.
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- App -->
  <script src="app.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Signage Survey · Southwood</title>

  <!-- Look & feel -->
  <style>
    :root{
      --bg:#0b1020;
      --panel:#101735;
      --soft:#121c3f;
      --text:#e8edf6;
      --muted:#a8b0c8;
      --line:#243161;
      --brand:#2bb673;   /* Southwood green */
      --accent:#43d68a;  /* lighter green for hovers */
      --blue:#4cc9f0;
      --warn:#f59e0b;
      --error:#ef4444;
      --ok:#22c55e;
      --chip:#1b2652;
      --chipBorder:#2b3a78;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}
    button{cursor:pointer}

    /* Top bar */
    .topbar{display:flex;align-items:center;gap:.75rem;padding:.7rem 1rem;border-bottom:1px solid var(--line);
      background:linear-gradient(180deg,#0f1632,#0d142c)}
    .logo{display:flex;align-items:center;gap:.6rem;font-weight:700;letter-spacing:.2px}
    .logo-dot{width:12px;height:12px;border-radius:50%;background:var(--brand);box-shadow:0 0 10px rgba(67,214,138,.4)}
    .pill-btn{background:#132047;border:1px solid var(--line);color:var(--text);padding:.45rem .7rem;border-radius:10px}
    .pill-btn:hover{background:#182b5a;border-color:#334687}
    .spacer{flex:1}
    .brand-tag{color:#b9f6d3;background:rgba(43,182,115,.12);border:1px solid rgba(43,182,115,.35);padding:.28rem .55rem;border-radius:999px;font-size:.85rem}

    /* Screens */
    .screen{display:none;height:calc(100% - 56px)} /* minus topbar */
    .screen.active{display:block}

    /* Home */
    .home-wrap{height:100%;display:grid;place-items:center}
    .home-card{width:min(900px,92vw);background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:1.2rem}
    .home-grid{display:grid;grid-template-columns:1fr 300px;gap:1rem}
    .card{background:#0f1734;border:1px solid var(--line);border-radius:12px;padding:.9rem}
    .card h3{margin:.1rem 0 .6rem 0;font-size:1.05rem;color:#d4defc}
    .list{display:grid;gap:.5rem;max-height:48vh;overflow:auto}
    .row{display:flex;align-items:center;justify-content:space-between;gap:.7rem;background:#0e1733;border:1px solid #22305d;border-radius:10px;padding:.5rem .6rem}
    .row .meta{display:flex;flex-direction:column;font-size:.9rem}
    .row .small{color:var(--muted);font-size:.78rem}

    /* Editor layout */
    .layout{display:grid;grid-template-columns:240px 1fr 340px;gap:.75rem;padding:.75rem;height:100%}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;min-height:0;display:flex;flex-direction:column;overflow:hidden}
    .panel h3{margin:0;padding:.6rem .8rem;border-bottom:1px solid var(--line);background:#121a3a;color:#cfe1ff;font-size:.95rem}
    .toolbar{display:flex;flex-wrap:wrap;gap:.45rem;padding:.55rem .7rem;border-bottom:1px solid var(--line);background:#0f1734}
    .btn{background:#16224a;border:1px solid var(--line);color:var(--text);padding:.45rem .6rem;border-radius:9px}
    .btn:hover{background:#1b2a59}
    .btn-brand{background:rgba(43,182,115,.14);border-color:rgba(43,182,115,.45)}
    .btn-brand:hover{background:rgba(43,182,115,.22)}
    input,select{background:#0f1836;border:1px solid #28376e;color:var(--text);padding:.45rem .55rem;border-radius:9px}
    .thumbs{padding:.6rem;display:grid;gap:.6rem;overflow:auto}
    .thumb{background:#0f1733;border:1px solid #22305d;border-radius:10px;padding:.45rem;cursor:pointer}
    .thumb.active{outline:2px solid var(--brand)}
    .thumb img{width:100%;height:110px;object-fit:cover;border-radius:8px;background:#061023}
    .thumb input{margin-top:.35rem;width:100%}

    .stage{position:relative;background:#09132b;border:2px dashed #26376c;border-radius:14px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .stage-inner{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center}
    #stageImage{max-width:100%;max-height:100%;display:block}
    #pinLayer{position:absolute;inset:0;pointer-events:none}
    .pin{position:absolute;transform:translate(-50%,-100%);padding:.22rem .45rem;font-size:.8rem;font-weight:700;border-radius:999px;border:1px solid rgba(0,0,0,.35);box-shadow:0 3px 10px rgba(0,0,0,.35);pointer-events:auto;color:#0a141f}
    .pin.selected{outline:2px solid #fff}
    .measure{position:absolute;pointer-events:none}
    .measure text{fill:#fff;font-size:12px;paint-order:stroke;stroke:#000;stroke-width:3}

    .section{padding:.6rem .75rem;border-bottom:1px solid var(--line)}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:.5rem}
    .row2{display:grid;grid-template-columns:110px 1fr;gap:.5rem;align-items:center;margin:.35rem 0}
    .chips{display:flex;gap:.35rem;flex-wrap:wrap}
    .tag{background:var(--chip);border:1px solid var(--chipBorder);color:#cfe1ff;border-radius:999px;padding:.15rem .45rem;font-size:.78rem}

    /* Modal (photo) */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.62);display:none;align-items:center;justify-content:center;z-index:50}
    .modal .box{background:#0f1733;border:1px solid #2b3566;border-radius:14px;width:min(1000px,96vw);height:min(86vh,96vh);display:flex;flex-direction:column}
    .modal .box header{display:flex;justify-content:space-between;align-items:center;padding:.6rem .8rem;border-bottom:1px solid #2b3566}
    .modal .box main{flex:1;display:grid;grid-template-columns:1fr 300px;min-height:0}
    .viewer{position:relative;background:#060a18;overflow:auto}
    .viewer img{display:block;max-width:100%;height:auto;margin:auto}
    .side{border-left:1px solid #2b3566;padding:.6rem;overflow:auto}
    .photo-tools{display:flex;gap:.4rem;flex-wrap:wrap}
    .muted{color:var(--muted)}
  </style>

  <!-- Libraries (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/5.1.0/tesseract.min.js"></script>
  <script>
    if (window['pdfjsLib']) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
    }
  </script>
</head>
<body>
  <div class="topbar">
    <div class="logo"><span class="logo-dot"></span> Southwood Signage Survey</div>
    <button class="pill-btn" id="btnHome">Home</button>
    <button class="pill-btn" id="btnProjects">Projects</button>
    <div class="spacer"></div>
    <span class="brand-tag">Southwood • Green</span>
  </div>

  <!-- Screen: HOME -->
  <div class="screen active" id="screen-home">
    <div class="home-wrap">
      <div class="home-card">
        <div class="home-grid">
          <div class="card">
            <h3>Quick Start</h3>
            <div style="display:flex;gap:.5rem;flex-wrap:wrap">
              <button class="btn btn-brand" id="homeNew">New Project</button>
              <button class="btn" id="homeImportCsv">Import CSV</button>
              <input type="file" id="inputImportCSV" accept="text/csv" style="display:none" />
              <button class="btn" id="homeOpenList">Open Projects</button>
            </div>
            <p class="muted" style="margin:.7rem 0 0 0">Create a project, upload plans (PDF or images), drop pins, add photos, and export your survey.</p>
          </div>
          <div class="card">
            <h3>About</h3>
            <p class="muted">Streamlined field tool with Southwood branding. Supports multi-page plans, draggable pins, multiple photos per pin, OCR, CSV/XLSX/ZIP export, and calibrated measurements on drawings and photos.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen: PROJECT LIST -->
  <div class="screen" id="screen-projects">
    <div class="home-wrap">
      <div class="home-card">
        <div class="card">
          <h3>Your Projects</h3>
          <div style="display:flex;gap:.4rem;margin-bottom:.6rem">
            <button class="btn btn-brand" id="plNew">New Project</button>
            <button class="btn" id="plRename">Rename</button>
            <button class="btn" id="plDelete">Delete</button>
            <button class="btn" id="plExport">Export All (JSON)</button>
            <input type="file" id="plImport" accept="application/json" style="display:none" />
            <button class="btn" id="plImportBtn">Import JSON</button>
          </div>
          <div class="list" id="projectList"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen: EDITOR -->
  <div class="screen" id="screen-editor">
    <div class="toolbar" id="editorToolbar">
      <button class="btn" id="btnNew">New</button>
      <button class="btn" id="btnOpenList">Open…</button>
      <button class="btn" id="btnSaveAs">Save As</button>
      <button class="btn" id="btnRename">Rename</button>

      <input type="file" id="inputUpload" accept="image/*,application/pdf" multiple style="display:none" />
      <button class="btn btn-brand" id="btnUpload">Upload Plan</button>

      <label class="btn" style="display:inline-flex;gap:.45rem;align-items:center">
        Building <input id="inputBuilding" style="width:120px" placeholder="A">
      </label>
      <label class="btn" style="display:inline-flex;gap:.45rem;align-items:center">
        Level <input id="inputLevel" style="width:80px" placeholder="1">
      </label>

      <button class="btn" id="btnExportCSV">CSV</button>
      <button class="btn" id="btnExportXLSX">Excel</button>
      <button class="btn" id="btnExportZIP">ZIP (+photos)</button>

      <button class="btn" id="btnOCR">OCR view</button>
      <button class="btn" id="btnCalibrate">Calibrate</button>
      <button class="btn" id="btnMeasureToggle">Measuring: OFF</button>
      <button class="btn" id="btnMeasureReset">Reset</button>

      <button class="btn" id="btnUndo">Undo</button>
      <button class="btn" id="btnRedo">Redo</button>

      <div class="spacer"></div>
      <span id="projectLabel" class="muted">—</span>
    </div>

    <div class="layout">
      <!-- Pages -->
      <div class="panel">
        <h3>Pages</h3>
        <div class="thumbs" id="thumbs"></div>
        <div style="padding:.55rem .7rem;border-top:1px solid var(--line);color:var(--muted);font-size:.85rem">
          Tip: Click a page to switch. Rename under each thumbnail.
        </div>
      </div>

      <!-- Stage -->
      <div class="panel stage" id="stage">
        <div class="stage-inner">
          <img id="stageImage" alt="No page yet" />
          <svg id="measureSvg" class="measure" width="100%" height="100%"></svg>
          <div id="pinLayer"></div>
        </div>
      </div>

      <!-- Right -->
      <div class="panel">
        <h3>Pin Details</h3>
        <div class="section">
          <div class="row2"><div>Selected</div><div id="selId" class="muted">None</div></div>
          <div class="row2">
            <div>Type / Name</div>
            <div>
              <input list="typeList" id="fieldType" placeholder="Choose or type custom">
              <datalist id="typeList"></datalist>
            </div>
          </div>
          <div class="row2"><div>Room #</div><input id="fieldRoomNum"></div>
          <div class="row2"><div>Room Name</div><input id="fieldRoomName"></div>
          <div class="row2"><div>Building</div><input id="fieldBuilding"></div>
          <div class="row2"><div>Level</div><input id="fieldLevel"></div>
          <div class="row2"><div>Notes</div><input id="fieldNotes"></div>
          <div class="row2"><div>Position</div><div id="posLabel" class="muted">—</div></div>
          <div class="grid2" style="margin-top:.5rem">
            <button class="btn" id="btnAddPhoto">Add Photo</button>
            <button class="btn" id="btnOpenPhoto">Open Photo</button>
            <button class="btn" id="btnDuplicate">Duplicate</button>
            <button class="btn" id="btnDelete">Delete</button>
          </div>
          <input type="file" id="inputPhoto" accept="image/*" multiple style="display:none">
          <div class="chips" id="warns" style="margin-top:.6rem"></div>
        </div>

        <h3>Pins</h3>
        <div class="section">
          <div style="display:flex;gap:.4rem;margin-bottom:.45rem">
            <input id="inputSearch" placeholder="Search…" style="flex:1">
            <select id="filterType"><option value="">All Types</option></select>
            <label class="btn" style="display:inline-flex;gap:.35rem;align-items:center">
              <input type="checkbox" id="toggleField"> Field Mode
            </label>
          </div>
          <div style="display:flex;gap:.4rem;margin-bottom:.45rem">
            <button class="btn" id="btnBulkType">Bulk Type</button>
            <button class="btn" id="btnBulkBL">Bulk Bldg/Level</button>
            <button class="btn" id="btnAddPin">Add Pin</button>
            <button class="btn" id="btnClearPins">Clear All</button>
          </div>
          <div class="list" id="pinList" style="max-height:280px"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Photo Modal -->
  <div class="modal" id="photoModal">
    <div class="box">
      <header>
        <strong>Photo Viewer & Measure</strong>
        <div class="photo-tools">
          <button class="btn" id="btnPhotoMeasure">Measure: OFF</button>
          <button class="btn" id="btnPhotoCalib">Calibrate</button>
          <button class="btn" id="btnPhotoPrev">Prev</button>
          <button class="btn" id="btnPhotoNext">Next</button>
          <button class="btn" id="btnPhotoDelete">Delete</button>
          <button class="btn" id="btnPhotoDownload">Download</button>
          <button class="btn" id="btnPhotoClose">Close</button>
        </div>
      </header>
      <main>
        <div class="viewer" id="photoViewer">
          <img id="photoImg" alt="">
          <svg id="photoMeasureSvg" class="measure" width="100%" height="100%" style="position:absolute;inset:0"></svg>
        </div>
        <div class="side">
          <div class="row2"><div>Pin</div><div id="photoPinId" class="muted">—</div></div>
          <div class="row2"><div>Photo</div><div id="photoName" class="muted">—</div></div>
          <div class="row2"><div>Measures</div><div id="photoMeaCount" class="muted">0</div></div>
          <p class="muted">Click once to start a line, move to see the live line, click again to finish, then enter your real dimension.</p>
        </div>
      </main>
    </div>
  </div>

  <!-- App code -->
  <script src="app.js"></script>
</body>
</html>

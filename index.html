<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Signage Survey</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%230a111f'/%3E%3Ccircle cx='18' cy='44' r='6' fill='%2322c55e'/%3E%3Ccircle cx='32' cy='24' r='6' fill='%2322c55e'/%3E%3Ccircle cx='46' cy='38' r='6' fill='%2322c55e'/%3E%3Cpath d='M18 44 L32 24 L46 38' stroke='%2322c55e' stroke-width='5' fill='none'/%3E%3C/svg%3E" />
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
  <style>
    :root{
      /* Southwood-y emerald accents */
      --accent:#22c55e;
      --accent-2:#16a34a;
      --bg:#0b1020;
      --panel:#0f172a;
      --panel-2:#111a33;
      --ink:#e6e9f5;
      --muted:#aab0c6;
      --line:#243056;
      --chip:#12203f;
      --soft:#0a1226;
      --warn:#f59e0b;
      --err:#ef4444;
      --blue:#3b82f6;
      --red:#ef4444;
      --shadow:0 8px 28px rgba(0,0,0,.35);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif}
    .app{display:grid;grid-template-rows:auto 1fr; height:100%}

    /* Toolbar */
    .toolbar{
      position:sticky;top:0;z-index:10;
      display:flex;flex-wrap:wrap;gap:.6rem;align-items:center;
      padding:.7rem .9rem;background:linear-gradient(180deg,#0e1630,#0a1226);
      border-bottom:1px solid var(--line);
      box-shadow:0 2px 12px rgba(0,0,0,.25);
    }
    .group{display:flex;gap:.4rem;align-items:center;background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:.35rem .45rem}
    .brand{display:flex;gap:.6rem;align-items:center;margin-right:.35rem}
    .dot{width:10px;height:10px;border-radius:999px;background:var(--accent);box-shadow:0 0 18px var(--accent)}
    .brand b{letter-spacing:.2px}

    button,.btn{background:#121b37;border:1px solid #2a3a6a;color:var(--ink);padding:.45rem .65rem;border-radius:10px;cursor:pointer}
    button:hover{background:#162144;border-color:#35508f}
    button.ok{background:var(--accent);border-color:#198f45;color:#061312}
    button.ghost{background:transparent;border-color:#32457a}
    input,select{background:#0e1631;border:1px solid #2a355f;color:var(--ink);padding:.45rem .55rem;border-radius:10px}
    .pill{display:inline-flex;gap:.4rem;align-items:center;padding:.25rem .5rem;background:#0e1631;border:1px solid #24345f;border-radius:999px}

    /* Main layout */
    .shell{display:grid; grid-template-columns: 260px 1fr 340px; gap:.9rem; padding:.9rem; height:100%; min-height:0;}
    .panel{background:var(--panel-2); border:1px solid var(--line); border-radius:var(--radius); overflow:hidden; display:flex; flex-direction:column; min-height:0; box-shadow:var(--shadow)}
    .panel header{padding:.65rem .85rem; background:#111a36; border-bottom:1px solid var(--line); font-weight:600; color:#cae6d5}
    .panel .body{padding:.6rem .7rem; overflow:auto; min-height:0}

    /* Left: Projects + Pages */
    .projects{padding:.5rem}
    .project-row{display:grid;grid-template-columns:1fr auto;gap:.4rem;align-items:center;padding:.4rem .45rem;border:1px solid #22305a;background:#0e1631;border-radius:10px}
    .project-row.active{outline:2px solid var(--accent)}
    .project-row small{color:var(--muted)}
    .thumbs{display:grid; gap:.55rem; padding:.5rem}
    .thumb{background:#0e1631;border:1px solid #283766;border-radius:12px;padding:.4rem;cursor:pointer}
    .thumb.active{outline:2px solid var(--accent)}
    .thumb img{width:100%;height:110px;object-fit:cover;border-radius:8px;background:#060a18}
    .thumb input{width:100%;margin-top:.35rem;font-size:.85rem}

    /* Stage */
    .stage{position:relative;display:flex;align-items:center;justify-content:center;background:#060b1a;border:1px dashed #2b3764;border-radius:var(--radius);overflow:hidden;margin:.6rem}
    .stage-inner{position:relative; width:100%; height:100%; display:flex; align-items:center; justify-content:center}
    #stageImage{max-width:100%; max-height:100%; display:block; user-select:none}
    #pinLayer{position:absolute; inset:0; pointer-events:none}
    .pin{position:absolute; transform:translate(-50%, -100%); padding:.22rem .45rem; font-size:.8rem; border-radius:999px; border:1px solid rgba(0,0,0,.35); color:#061312; font-weight:800; box-shadow:0 6px 18px rgba(0,0,0,.36); pointer-events:auto; cursor:grab}
    .pin:active{cursor:grabbing}
    .pin.selected{outline:2px solid #fff}
    svg.measure{position:absolute; inset:0; pointer-events:none}
    .measure text{fill:#fff; font-size:12px; paint-order:stroke; stroke:#000; stroke-width:3}

    /* Right: details */
    .row{display:grid; grid-template-columns:120px 1fr; gap:.5rem; align-items:center; margin:.4rem 0}
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:.5rem}
    .list{display:grid; gap:.4rem; max-height:320px; overflow:auto}
    .item{display:grid; grid-template-columns:22px 1fr auto; align-items:center; gap:.55rem; padding:.4rem .5rem; background:#0e1631; border:1px solid #273560; border-radius:10px}
    .muted{color:var(--muted)}
    .chips{display:flex; flex-wrap:wrap; gap:.35rem}
    .tag{font-size:.75rem; padding:.18rem .45rem; border-radius:999px; background:#122145; border:1px solid #2a3f76}
    .tag.warn{background:#2a1f06; border-color:#6f4c0a; color:#ffdc9a}

    .footer-note{font-size:.8rem;color:#9bb9a9;padding:.55rem .75rem;border-top:1px dashed #2b3b6a}
    .hidden{display:none}

    /* Modal */
    .modal{position:fixed; inset:0; background:rgba(0,0,0,.65); display:none; align-items:center; justify-content:center; z-index:50}
    .modal .box{background:#0f1733; border:1px solid #2b3566; border-radius:16px; width:min(980px,96vw); height:min(86vh,96vh); display:flex; flex-direction:column; box-shadow:var(--shadow)}
    .modal .box header{display:flex; justify-content:space-between; align-items:center; padding:.7rem 1rem; border-bottom:1px solid #2b3566}
    .modal .box main{flex:1; display:grid; grid-template-columns: 1fr 300px; min-height:0}
    .viewer{position:relative; background:#060a18; display:flex; align-items:center; justify-content:center}
    .viewer img{max-width:100%; max-height:100%}
    .side{border-left:1px solid #2b3566; padding:.7rem .75rem; overflow:auto}
    .side .row{grid-template-columns:90px 1fr}
  </style>

  <!-- libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/5.1.0/tesseract.min.js"></script>
  <script>
    if(window.pdfjsLib){
      pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
    }
  </script>
</head>
<body>
  <div class="app">
    <!-- Toolbar -->
    <div class="toolbar">
      <div class="brand"><span class="dot"></span><b>Signage Survey</b></div>

      <div class="group">
        <select id="projectPicker"></select>
        <button id="btnNew">New</button>
        <button id="btnSaveAs">Save As</button>
        <button id="btnRename" class="ghost">Rename</button>
      </div>

      <div class="group">
        <input type="file" id="inputUpload" accept="image/*,application/pdf" multiple class="hidden" />
        <button id="btnUpload">Add Image/PDF</button>
        <span class="pill">Bldg <input id="inputBuilding" style="width:120px" placeholder="A"/></span>
        <span class="pill">Level <input id="inputLevel" style="width:80px" placeholder="1"/></span>
      </div>

      <div class="group">
        <button id="btnExportCSV">CSV</button>
        <button id="btnExportXLSX">Excel</button>
        <button id="btnExportZIP">ZIP+Photos</button>
        <input type="file" id="inputImportCSV" accept="text/csv" class="hidden" />
        <button id="btnImportCSV" class="ghost">Import CSV</button>
      </div>

      <div class="group">
        <button id="btnOCR" class="ghost">OCR View</button>
        <button id="btnCalibrate">Calibrate</button>
        <button id="btnMeasureToggle">Measure: OFF</button>
        <button id="btnMeasureReset" class="ghost">Reset</button>
      </div>

      <div class="group">
        <button id="btnUndo" class="ghost">Undo</button>
        <button id="btnRedo" class="ghost">Redo</button>
      </div>

      <div class="group">
        <input id="inputSearch" placeholder="Search pins…" style="width:200px"/>
        <select id="filterType"><option value="">All Types</option></select>
        <label class="pill"><input type="checkbox" id="toggleField"> Field Mode</label>
      </div>

      <div class="group">
        <button id="btnAddPin" title="Click, then click map to place" class="ok">Add Pin</button>
        <button id="btnClearPins" class="ghost">Clear Page Pins</button>
      </div>

      <div id="projectLabel" class="muted" style="margin-left:auto">—</div>
    </div>

    <!-- Main -->
    <div class="shell">
      <!-- Left: Projects & Pages -->
      <div class="panel">
        <header>Projects</header>
        <div class="body">
          <div id="projectsList" class="projects"></div>
        </div>

        <header style="margin-top:.4rem">Pages</header>
        <div class="body">
          <div id="thumbs" class="thumbs"></div>
          <div class="footer-note">Click to switch. Rename below each thumbnail.</div>
        </div>
      </div>

      <!-- Stage -->
      <div class="panel">
        <header>Canvas</header>
        <div class="body" style="padding:.2rem .2rem 0;">
          <div class="stage" id="stage" style="height: calc(100vh - 210px);">
            <div class="stage-inner">
              <img id="stageImage" alt="No page yet" draggable="false" />
              <svg id="measureSvg" class="measure" width="100%" height="100%"></svg>
              <div id="pinLayer"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: Pin Details -->
      <div class="panel">
        <header>Pin Details</header>
        <div class="body">
          <div class="row"><div>Selected</div><div id="selId" class="muted">None</div></div>
          <div class="row">
            <div>Type</div>
            <div>
              <input id="fieldType" list="typeList" placeholder="Type or pick…" />
              <datalist id="typeList"></datalist>
            </div>
          </div>
          <div class="row"><div>Label</div><input id="fieldLabel" placeholder="Optional short label (shown on map)"/></div>
          <div class="row"><div>Room #</div><input id="fieldRoomNum"/></div>
          <div class="row"><div>Room Name</div><input id="fieldRoomName"/></div>
          <div class="row"><div>Building</div><input id="fieldBuilding"/></div>
          <div class="row"><div>Level</div><input id="fieldLevel"/></div>
          <div class="row"><div>Notes</div><input id="fieldNotes" placeholder="Any notes…"/></div>
          <div class="row"><div>Position</div><div id="posLabel" class="muted">—</div></div>

          <div class="grid2" style="margin-top:.35rem">
            <button id="btnAddPhoto">Add Photo(s)</button>
            <button id="btnOpenPhoto">Open Viewer</button>
            <button id="btnDuplicate" class="ghost">Duplicate</button>
            <button id="btnDelete" class="ghost">Delete</button>
          </div>
          <input type="file" id="inputPhoto" class="hidden" accept="image/*" multiple />
          <div id="warns" class="chips" style="margin-top:.5rem"></div>
        </div>

        <header>Pins on Page</header>
        <div class="body">
          <div id="pinList" class="list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Photo Modal -->
  <div class="modal" id="photoModal">
    <div class="box">
      <header>
        <strong>Photo Viewer & Measure</strong>
        <div style="display:flex; gap:.5rem">
          <button id="btnPhotoMeasure">Measure: OFF</button>
          <button id="btnPhotoCalib">Calibrate</button>
          <button id="btnPhotoClose">Close</button>
        </div>
      </header>
      <main>
        <div class="viewer">
          <img id="photoImg" alt="photo"/>
          <svg id="photoMeasureSvg" class="measure" width="100%" height="100%"></svg>
        </div>
        <div class="side">
          <div class="row"><div>Pin</div><div id="photoPinId" class="muted">—</div></div>
          <div class="row"><div>Photo</div><div id="photoName" class="muted">—</div></div>
          <div class="row"><div>Measures</div><div id="photoMeaCount" class="muted">0</div></div>
          <div class="grid2" style="margin-top:.5rem">
            <button id="btnPhotoPrev">Prev</button>
            <button id="btnPhotoNext">Next</button>
            <button id="btnPhotoDelete" class="ghost">Delete</button>
            <button id="btnPhotoDownload">Download</button>
          </div>
          <div class="footer-note">
            Draw a line, then type the real length (e.g. “6.5 ft”). Leave blank to store pixels only.<br/>
            Use <b>Calibrate</b> to set a scale for auto-feet from pixels.
          </div>
        </div>
      </main>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
